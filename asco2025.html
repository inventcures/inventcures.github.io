<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCO 2025 Clinical Trial Pipeline Dashboard</title>
    <meta name="description" content="Interactive dashboard visualizing clinical trials in progress from ASCO 2025.">
    
    <!-- External libraries -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #2c5aa0 0%, #4a6741 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: linear-gradient(135deg, #0f4c75 0%, #3282b8 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(15, 76, 117, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .description {
            max-width: 800px;
            margin: 0 auto 20px;
            font-size: 1rem;
            line-height: 1.7;
        }

        .note {
            font-size: 0.9rem;
            opacity: 0.8;
            font-style: italic;
        }

        .note a {
            color: #64ffda;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .note a:hover {
            color: #80e5ff;
            text-decoration: underline;
        }

        .author-name {
            color: #ffd54f;
            font-weight: 600;
        }

        .homepage-link {
            position: absolute;
            top: 20px;
            left: 35px;
            color: #ffffff;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .homepage-link:hover {
            color: #64ffda;
            transform: translateX(-2px);
        }

        .homepage-link::before {
            content: "←";
            font-size: 1.2rem;
            color: #64ffda;
        }

        .subtitle a {
            color: #64ffda;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .subtitle a:hover {
            color: #80e5ff;
            text-decoration: underline;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: nowrap;
            justify-content: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            overflow-x: auto;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-shrink: 0;
            min-width: 120px;
        }

        .filter-group label {
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
        }

        .filter-select {
            padding: 6px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            min-width: 120px;
            transition: border-color 0.2s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .main-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }

        .sidebar {
            min-width: 250px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
        }

        .cancer-type-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .cancer-type-item {
            padding: 12px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            border: 2px solid transparent;
        }

        .cancer-type-item:hover {
            background: #e9ecef;
            transform: translateX(2px);
        }

        .cancer-type-item.active {
            background: #667eea;
            color: white;
            border-color: #5a6fd8;
            font-weight: 500;
        }

        .chart-container {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        #scatter-plot {
            width: 100%;
            height: 600px;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 13px;
            color: #ffffff;
        }

        .tooltip-details div {
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .abstract-preview {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #444;
            font-size: 11px;
            line-height: 1.3;
        }

        .tooltip-action {
            margin-top: 8px;
            font-style: italic;
            color: #ccc;
            font-size: 11px;
        }

        .background-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin-top: 40px;
        }

        .background-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .background-section p {
            color: #666;
            line-height: 1.7;
        }

        .data-point {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .data-point:hover {
            stroke: #333;
            stroke-width: 2px;
            r: 8;
        }

        .axis-title {
            font-size: 12px;
            fill: #666;
        }

        .axis text {
            font-size: 11px;
            fill: #666;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #ccc;
            shape-rendering: crispEdges;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            #scatter-plot {
                height: 400px;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }

        .phase-indicator {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }

        .phase-1 { background-color: #ff6b6b; }
        .phase-12 { background-color: #96ceb4; }
        .phase-2 { background-color: #4ecdc4; }
        .phase-23 { background-color: #feca57; }
        .phase-3 { background-color: #8e44ad; }

        .stats-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .track-breakdown {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .track-breakdown h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .track-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0px;
        }

        .track-column {
            padding: 0 15px;
            border-right: 2px solid #000;
        }

        .track-column:last-child {
            border-right: none;
        }

        .track-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .track-item:last-child {
            border-bottom: none;
        }

        .track-name {
            font-weight: 500;
        }

        .track-count {
            color: #667eea;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <a href="https://inventcures.github.io" class="homepage-link">Homepage</a>
            <h1>ASCO 2025 Clinical Trial Pipeline</h1>
            <p class="subtitle">Trials in Progress from the <a href="https://www.asco.org/meetings-events/annual-meeting" target="_blank">ASCO 2025 Annual Meeting</a></p>
            
            <div class="description">
                <p>This interactive dashboard visualizes 385 clinical trials in progress (TPS abstracts) reported at ASCO 2025. These represent the future of cancer treatment, featuring ongoing studies across multiple cancer types and novel therapeutic approaches. Each data point represents a trial currently enrolling or in development, providing insights into the clinical research pipeline across 12 different cancer tracks spanning from early-phase exploratory studies to large confirmatory trials.</p>
            </div>
            
            <p class="note">Note: This data is extracted from ASCO 2025 abstracts by <span class="author-name">Ashish Makani</span> (<a href="https://inventcures.github.io" target="_blank">homepage</a>, <a href="https://x.com/inventcures" target="_blank">X</a>) using LLMs. 
                Please report any data quality issues to spiff007@{free email service from Google}. </p>
                <p> <b>All data is the copyright of ASCO, ©ASCO. It is visualized here to be useful to the cancer research community.</b></p>
        </header>

        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number">385</span>
                    <div class="stat-label">Total Clinical Trials</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">12</span>
                    <div class="stat-label">Cancer Tracks</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">217</span>
                    <div class="stat-label">Early Phase Trials (1 & 1/2)</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">121</span>
                    <div class="stat-label">Largest Track (Developmental Therapeutics)</div>
                </div>
            </div>
            
            <div class="track-breakdown">
                <h3>Distribution by Cancer Track</h3>
                <div class="track-list">
                    <div class="track-column">
                        <div class="track-item">
                            <span class="track-name">Developmental Therapeutics</span>
                            <span class="track-count">121 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">Breast Cancer</span>
                            <span class="track-count">49 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">Hematologic Malignancies</span>
                            <span class="track-count">47 trials</span>
                        </div>
                    </div>
                    <div class="track-column">
                        <div class="track-item">
                            <span class="track-name">Lung Cancer</span>
                            <span class="track-count">41 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">Genitourinary Cancers</span>
                            <span class="track-count">36 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">CNS/Brain Tumors</span>
                            <span class="track-count">29 trials</span>
                        </div>
                    </div>
                    <div class="track-column">
                        <div class="track-item">
                            <span class="track-name">Melanoma/Skin Cancers</span>
                            <span class="track-count">29 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">Gastrointestinal Cancers</span>
                            <span class="track-count">22 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">Sarcoma</span>
                            <span class="track-count">5 trials</span>
                        </div>
                    </div>
                    <div class="track-column">
                        <div class="track-item">
                            <span class="track-name">Head and Neck Cancer</span>
                            <span class="track-count">3 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">Quality Care/Health Services Research</span>
                            <span class="track-count">2 trials</span>
                        </div>
                        <div class="track-item">
                            <span class="track-name">Gynecologic Cancers</span>
                            <span class="track-count">1 trials</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <p style="margin-top: 20px; color: #666; line-height: 1.6;">
                This comprehensive dataset represents the cutting edge of cancer research, spanning 385 ongoing clinical trials across 12 distinct cancer tracks. The studies showcase breakthrough approaches including CAR-T cell therapies, antibody-drug conjugates (ADCs), next-generation checkpoint inhibitors, and innovative precision medicine strategies. With enrollment targets ranging from small Phase 1 dose-escalation studies of 12 patients to large confirmatory trials of 1149 participants (average: 116 patients per study), these investigations collectively represent billions of dollars in research investment and the therapeutic pipeline for millions of cancer patients worldwide. The dominance of developmental therapeutics (121 studies), breast cancer (49 studies), and hematologic malignancies (47 studies) reflects both urgent unmet medical needs and significant recent advances in our molecular understanding of these diseases. The 217 early-phase trials (56% of all studies) demonstrate the experimental nature of this pipeline, featuring 167 distinct investigational agents from 38 companies worldwide.
            </p>
        </div>

        <div class="controls">
            <div class="filter-group">
                <label for="population-filter">Filter by patient population/subgroup</label>
                <select id="population-filter" class="filter-select">
                    <option value="">All populations</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="phase-filter">Type of trial (Phase)</label>
                <select id="phase-filter" class="filter-select">
                    <option value="">All phases</option>
                    <option value="Phase 1">Phase 1</option>
                    <option value="Phase 2">Phase 2</option>
                    <option value="Phase 3">Phase 3</option>
                    <option value="Phase 1/2">Phase 1/2</option>
                    <option value="Phase 2/3">Phase 2/3</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="company-filter">Filter by company</label>
                <select id="company-filter" class="filter-select">
                    <option value="">All companies</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="trial-filter">Filter by trial name</label>
                <select id="trial-filter" class="filter-select">
                    <option value="">All trials</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="drug-filter">Filter by drug</label>
                <select id="drug-filter" class="filter-select">
                    <option value="">All drugs</option>
                </select>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="cancer-type-list">
                    <div class="cancer-type-item active" data-track="all">All tracks</div>
                </div>
            </div>

            <div class="chart-container">
                <div id="scatter-plot"></div>
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-dot phase-1"></span>
                        <span>Phase 1</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot phase-12"></span>
                        <span>Phase 1/2</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot phase-2"></span>
                        <span>Phase 2</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot phase-23"></span>
                        <span>Phase 2/3</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot phase-3"></span>
                        <span>Phase 3</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="background-section">
            <h2>Background</h2>
            <p>The trials shown above are from ASCO 2025 "Trials in Progress" (TPS) abstracts. These represent ongoing clinical studies that are actively enrolling patients or in development phases. Unlike completed trial results, TPS abstracts provide insights into the future pipeline of cancer therapeutics and research directions. This dashboard helps researchers, clinicians, and patients understand what treatments are being developed and tested across different cancer types.</p>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip" style="display: none;">
        <div class="tooltip-content">
            <div class="tooltip-title"></div>
            <div class="tooltip-details"></div>
        </div>
    </div>

    <script src="asco2025_comprehensive_data.js?v=20250603"></script>
    <script>

// Dashboard JavaScript
class ASCOTrialDashboard {
    constructor() {
        this.data = ascoTrialData;
        this.filteredData = [...this.data];
        this.selectedTrack = '';
        this.margin = { top: 20, right: 60, bottom: 60, left: 60 };
        this.width = 800 - this.margin.left - this.margin.right;
        this.height = 500 - this.margin.bottom - this.margin.top;
        
        this.init();
    }

    init() {
        this.setupFilters();
        this.setupSidebar();
        this.createChart();
        this.setupTooltip();
    }

    setupFilters() {
        // Extract unique values for each filter type
        const populations = [...new Set(this.data.map(d => d.targetPopulation).filter(p => p))].sort();
        const companies = [...new Set(this.data.map(d => d.company).filter(c => c))].sort();
        const trialNames = [...new Set(this.data.map(d => d.trialName).filter(t => t))].sort();
        const drugs = [...new Set(this.data.map(d => d.drug).filter(d => d))].sort();

        // Populate population filter
        const populationFilter = document.getElementById('population-filter');
        populations.forEach(population => {
            const option = document.createElement('option');
            option.value = population;
            option.textContent = population;
            populationFilter.appendChild(option);
        });

        // Populate company filter
        const companyFilter = document.getElementById('company-filter');
        companies.forEach(company => {
            const option = document.createElement('option');
            option.value = company;
            option.textContent = company;
            companyFilter.appendChild(option);
        });

        // Populate trial name filter
        const trialFilter = document.getElementById('trial-filter');
        trialNames.forEach(trial => {
            const option = document.createElement('option');
            option.value = trial;
            option.textContent = trial;
            trialFilter.appendChild(option);
        });

        // Populate drug filter
        const drugFilter = document.getElementById('drug-filter');
        drugs.forEach(drug => {
            const option = document.createElement('option');
            option.value = drug;
            option.textContent = drug;
            drugFilter.appendChild(option);
        });

        // Add event listeners for all filters
        populationFilter.addEventListener('change', () => this.applyFilters());
        document.getElementById('phase-filter').addEventListener('change', () => this.applyFilters());
        companyFilter.addEventListener('change', () => this.applyFilters());
        trialFilter.addEventListener('change', () => this.applyFilters());
        drugFilter.addEventListener('change', () => this.applyFilters());
    }

    setupSidebar() {
        const sidebar = document.querySelector('.cancer-type-list');
        const tracks = [...new Set(this.data.map(d => d.track))].sort();
        
        tracks.forEach(track => {
            const item = document.createElement('div');
            item.className = 'cancer-type-item';
            item.textContent = track;
            item.setAttribute('data-track', track);
            item.addEventListener('click', () => this.selectTrack(track));
            sidebar.appendChild(item);
        });

        const allItem = sidebar.querySelector('[data-track="all"]');
        allItem.addEventListener('click', () => this.selectTrack('all'));
    }

    selectTrack(track) {
        document.querySelectorAll('.cancer-type-item').forEach(item => {
            item.classList.remove('active');
        });
        
        const selectedItem = document.querySelector(`[data-track="${track}"]`);
        if (selectedItem) {
            selectedItem.classList.add('active');
        }

        this.selectedTrack = track === 'all' ? '' : track;
        this.applyFilters();
    }

    applyFilters() {
        const populationFilter = document.getElementById('population-filter').value;
        const phaseFilter = document.getElementById('phase-filter').value;
        const companyFilter = document.getElementById('company-filter').value;
        const trialFilter = document.getElementById('trial-filter').value;
        const drugFilter = document.getElementById('drug-filter').value;

        this.filteredData = this.data.filter(d => {
            const matchesTrack = !this.selectedTrack || d.track === this.selectedTrack;
            const matchesPopulation = !populationFilter || d.targetPopulation === populationFilter;
            const matchesPhase = !phaseFilter || d.trialPhase === phaseFilter;
            const matchesCompany = !companyFilter || d.company === companyFilter;
            const matchesTrial = !trialFilter || d.trialName === trialFilter;
            const matchesDrug = !drugFilter || d.drug === drugFilter;
            
            return matchesTrack && matchesPopulation && matchesPhase && matchesCompany && matchesTrial && matchesDrug;
        });

        this.updateChart();
    }

    createChart() {
        d3.select("#scatter-plot").selectAll("*").remove();

        const svg = d3.select("#scatter-plot")
            .append("svg")
            .attr("width", this.width + this.margin.left + this.margin.right)
            .attr("height", this.height + this.margin.top + this.margin.bottom);

        this.g = svg.append("g")
            .attr("transform", `translate(${this.margin.left},${this.margin.top})`);

        this.xScale = d3.scaleLinear().range([0, this.width]);
        this.yScale = d3.scaleLinear().range([this.height, 0]);

        this.xAxis = d3.axisBottom(this.xScale).tickFormat(d3.format("d"));
        this.yAxis = d3.axisLeft(this.yScale);

        this.g.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${this.height})`);

        this.g.append("g")
            .attr("class", "y-axis");

        this.g.append("text")
            .attr("class", "axis-title")
            .attr("transform", `translate(${this.width/2}, ${this.height + 45})`)
            .style("text-anchor", "middle")
            .text("Estimated Enrollment");

        this.g.append("text")
            .attr("class", "axis-title")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - this.margin.left)
            .attr("x", 0 - (this.height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Trial Index (by Phase)");

        this.updateChart();
    }

    updateChart() {
        const validData = this.filteredData.filter(d => d.estimatedEnrollment > 0);
        
        // Create y-position based on phase
        const phaseOrder = ["Phase 1", "Phase 1/2", "Phase 2", "Phase 2/3", "Phase 3"];
        const dataWithPosition = validData.map((d, i) => ({
            ...d,
            yPosition: phaseOrder.indexOf(d.trialPhase) * 100 + (i % 5) * 15 + 50
        }));

        const xExtent = d3.extent(dataWithPosition, d => d.estimatedEnrollment);
        
        this.xScale.domain([0, Math.max(xExtent[1] * 1.1, 100)]);
        this.yScale.domain([0, 500]);

        this.g.select(".x-axis")
            .transition()
            .duration(750)
            .call(this.xAxis);

        this.g.select(".y-axis")
            .transition()
            .duration(750)
            .call(this.yAxis);

        const circles = this.g.selectAll(".data-point")
            .data(dataWithPosition, d => d.tpsId);

        circles.exit()
            .transition()
            .duration(500)
            .attr("r", 0)
            .remove();

        const circlesEnter = circles.enter()
            .append("circle")
            .attr("class", "data-point")
            .attr("r", 0)
            .attr("cx", d => this.xScale(d.estimatedEnrollment))
            .attr("cy", d => this.yScale(d.yPosition));

        circles.merge(circlesEnter)
            .transition()
            .duration(750)
            .attr("cx", d => this.xScale(d.estimatedEnrollment))
            .attr("cy", d => this.yScale(d.yPosition))
            .attr("r", 8)
            .attr("fill", d => this.getPhaseColor(d.trialPhase))
            .attr("opacity", 0.8);

        this.g.selectAll(".data-point")
            .on("mouseover", (event, d) => this.showTooltip(event, d))
            .on("mouseout", () => this.hideTooltip())
            .on("mousemove", (event) => this.moveTooltip(event))
            .on("click", (event, d) => this.openPDF(d));
    }

    getPhaseColor(phase) {
        const colorMap = {
            "Phase 1": "#ff6b6b",
            "Phase 1/2": "#96ceb4",
            "Phase 2": "#4ecdc4",
            "Phase 2/3": "#feca57",
            "Phase 3": "#8e44ad"
        };
        return colorMap[phase] || "#999";
    }

    setupTooltip() {
        this.tooltip = d3.select("#tooltip");
    }

    showTooltip(event, d) {
        const abstractText = `Click to view the full ${d.tpsId} abstract with trial details.`;
        
        this.tooltip.html(`
            <div class="tooltip-title">${d.title}</div>
            <div class="tooltip-details">
                <div><strong>TPS ID:</strong> ${d.tpsId}</div>
                <div><strong>Track:</strong> ${d.track}</div>
                <div><strong>Phase:</strong> ${d.trialPhase}</div>
                <div><strong>Cancer Type:</strong> ${d.cancerType}</div>
                <div><strong>Drug:</strong> ${d.drug}</div>
                <div><strong>Target Population:</strong> ${d.targetPopulation}</div>
                <div><strong>Primary Endpoint:</strong> ${d.primaryEndpoint}</div>
                <div><strong>Estimated Enrollment:</strong> ${d.estimatedEnrollment}</div>
                ${d.trialRegistry ? `<div><strong>Registry:</strong> ${d.trialRegistry}</div>` : ''}
                <div class="abstract-preview"><strong>Background:</strong> ${d.backgroundExcerpt}</div>
                <div class="tooltip-action">Click to view full PDF abstract</div>
            </div>
        `);

        this.tooltip.style("display", "block");
        this.moveTooltip(event);
    }

    moveTooltip(event) {
        const tooltipWidth = this.tooltip.node().offsetWidth;
        const tooltipHeight = this.tooltip.node().offsetHeight;
        
        let left = event.pageX + 10;
        let top = event.pageY - 10;
        
        if (left + tooltipWidth > window.innerWidth) {
            left = event.pageX - tooltipWidth - 10;
        }
        
        if (top + tooltipHeight > window.innerHeight) {
            top = event.pageY - tooltipHeight - 10;
        }
        
        this.tooltip
            .style("left", left + "px")
            .style("top", top + "px");
    }

    hideTooltip() {
        this.tooltip.style("display", "none");
    }

    openPDF(trial) {
        // Construct the PDF filename based on TPS ID
        const pdfFileName = `${trial.tpsId}.pdf`;
        
        // Use current directory path for PDFs
        const baseUrl = window.location.href.split('/').slice(0, -1).join('/');
        const pdfUrl = `${baseUrl}/tps_abstracts/${pdfFileName}`;
        
        window.open(pdfUrl, '_blank');
    }
}

// Initialize dashboard when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    try {
        const dashboard = new ASCOTrialDashboard();
        window.dashboard = dashboard;
        console.log('ASCO Dashboard initialized successfully');
    } catch (error) {
        console.error('Error creating dashboard:', error);
    }
});

window.addEventListener('resize', function() {
    clearTimeout(window.resizeTimeout);
    window.resizeTimeout = setTimeout(() => {
        if (window.dashboard) {
            window.dashboard.createChart();
        }
    }, 250);
});
    </script>
</body>
</html>